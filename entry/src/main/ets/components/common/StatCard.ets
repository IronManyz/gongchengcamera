/**
 * ç»Ÿè®¡å¡ç‰‡ç»„ä»¶
 * ç”¨äºå±•ç¤ºæ•°æ®ç»Ÿè®¡ä¿¡æ¯
 */

@ComponentV2
export struct StatCard {
  @Param title: string = ''
  @Param value: string | number = ''
  @Param icon: string = 'ğŸ“'
  @Param color: string = '#1890FF'
  @Param trend?: 'up' | 'down' | 'stable' = 'stable'
  @Param subtitle?: string = ''
  @Param progress?: number = undefined // æ–°å¢è¿›åº¦å‚æ•°
  @Param showLoading?: boolean = false // æ–°å¢åŠ è½½çŠ¶æ€
  @Param onTap?: () => void = () => {} // æ–°å¢ç‚¹å‡»å›è°ƒ

  build() {
    Column() {
      // å›¾æ ‡å’Œæ•°å€¼
      Row() {
        // å›¾æ ‡
        if (this.showLoading) {
          LoadingProgress()
            .width(20)
            .height(20)
            .color(this.color)
            .margin({ right: 12 })
        } else {
          Text(this.icon)
            .fontSize(20)
            .fontColor(this.color)
            .margin({ right: 12 })
        }

        Column() {
          // æ•°å€¼
          if (this.showLoading) {
            Text('...')
              .fontSize(24)
              .fontWeight(FontWeight.Bold)
              .fontColor('#999999')
          } else {
            Text(typeof this.value === 'number' ? this.value.toString() : this.value)
              .fontSize(24)
              .fontWeight(FontWeight.Bold)
              .fontColor('#262626')
          }

          // æ ‡é¢˜
          Text(this.title)
            .fontSize(14)
            .fontColor('#8C8C8C')
            .margin({ top: 4 })
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1)

        // è¶‹åŠ¿æŒ‡ç¤ºå™¨
        if (this.trend) {
          this.buildTrendIndicator()
        }
      }
      .width('100%')
      .alignItems(VerticalAlign.Center)

      // å‰¯æ ‡é¢˜
      if (this.subtitle) {
        Text(this.subtitle)
          .fontSize(12)
          .fontColor('#A6A6A6')
          .margin({ top: 8 })
          .textAlign(TextAlign.Start)
          .width('100%')
      }

      // è¿›åº¦æ¡ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
      if (this.progress !== undefined) {
        this.buildProgressBar()
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .borderRadius(8)
    .shadow({
      radius: 4,
      color: '#00000010',
      offsetX: 0,
      offsetY: 2
    })
    .onClick(() => {
      if (this.onTap && !this.showLoading) {
        this.onTap()
      }
    })
  }

  /**
   * æ„å»ºè¿›åº¦æ¡
   */
  @Builder
  private buildProgressBar(): void {
    Column({ space: 8 }) {
      // è¿›åº¦æ¡æ ‡ç­¾
      Row() {
        Text('å®Œæˆè¿›åº¦')
          .fontSize(12)
          .fontColor('#666666')

        Text(`${this.progress}%`)
          .fontSize(14)
          .fontWeight(FontWeight.Medium)
          .fontColor('#333333')
          .margin({ left: 8 })
      }
      .width('100%')

      // è¿›åº¦æ¡
      Progress({
        value: this.progress || 0,
        total: 100,
        type: ProgressType.Linear
      })
        .width('100%')
        .height(6)
        .backgroundColor('#F0F0F0')
        .color(this.color)
        .borderRadius(3)

      // è¿›åº¦æè¿°
      if (this.progress && this.progress >= 100) {
        Text('ä»»åŠ¡å®Œæˆ')
          .fontSize(12)
          .fontColor('#52C41A')
          .margin({ top: 4 })
          .textAlign(TextAlign.Center)
          .width('100%')
      } else if (this.progress && this.progress >= 75) {
        Text('å³å°†å®Œæˆ')
          .fontSize(12)
          .fontColor('#FAAD14')
          .margin({ top: 4 })
          .textAlign(TextAlign.Center)
          .width('100%')
      } else if (this.progress && this.progress >= 50) {
        Text('è¿›è¡Œä¸­')
          .fontSize(12)
          .fontColor('#1890FF')
          .margin({ top: 4 })
          .textAlign(TextAlign.Center)
          .width('100%')
      }
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#F8F9FA')
    .borderRadius(6)
  }

  /**
   * æ„å»ºè¶‹åŠ¿æŒ‡ç¤ºå™¨
   */
  @Builder
  private buildTrendIndicator() {
    Row() {
      if (this.trend === 'up') {
        Text('â†‘')
          .fontSize(16)
          .fontColor('#52C41A')
      } else if (this.trend === 'down') {
        Text('â†“')
          .fontSize(16)
          .fontColor('#FF4D4F')
      }

      if (this.trend !== 'stable') {
        Text(this.trend === 'up' ? 'ä¸Šå‡' : 'ä¸‹é™')
          .fontSize(12)
          .fontColor(this.trend === 'up' ? '#52C41A' : '#FF4D4F')
          .margin({ left: 4 })
      }
    }
  }
}