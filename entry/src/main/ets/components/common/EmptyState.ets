/**
 * ç©ºçŠ¶æ€ç»„ä»¶
 * æä¾›ç»Ÿä¸€çš„ç©ºæ•°æ®å±•ç¤ºå’Œæ“ä½œå¼•å¯¼
 */

import { ThemeManager } from '../../theme/ThemeManager'

export interface EmptyStateConfig {
  icon?: string
  title: string
  description?: string
  actionText?: string
  onAction?: () => void
  type?: 'default' | 'search' | 'error' | 'network' | 'permission'
  customImage?: string
}

@ComponentV2
export struct EmptyState {
  @Param config?: EmptyStateConfig
  @Param height?: number = 300
  @Param showBackground: boolean = true

  private get defaultConfig(): EmptyStateConfig {
    return {
      title: 'æš‚æ— æ•°æ®',
      description: 'è¿™é‡Œè¿˜æ²¡æœ‰å†…å®¹',
      type: 'default'
    }
  }

  private get currentConfig(): EmptyStateConfig {
    return { ...this.defaultConfig, ...this.config }
  }

  private getDefaultIcon(): string {
    switch (this.currentConfig.type) {
      case 'search': return 'ğŸ”'
      case 'error': return 'âš ï¸'
      case 'network': return 'ğŸŒ'
      case 'permission': return 'ğŸ”’'
      default: return 'ğŸ“­'
    }
  }

  private getDefaultTitle(): string {
    switch (this.currentConfig.type) {
      case 'search': return 'æœªæ‰¾åˆ°ç»“æœ'
      case 'error': return 'åŠ è½½å¤±è´¥'
      case 'network': return 'ç½‘ç»œè¿æ¥å¼‚å¸¸'
      case 'permission': return 'æƒé™ä¸è¶³'
      default: return 'æš‚æ— æ•°æ®'
    }
  }

  private getDefaultDescription(): string {
    switch (this.currentConfig.type) {
      case 'search': return 'å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æœç´¢'
      case 'error': return 'è¯·ç¨åé‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ'
      case 'network': return 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•'
      case 'permission': return 'è¯·åœ¨è®¾ç½®ä¸­å¼€å¯ç›¸å…³æƒé™'
      default: return 'è¿™é‡Œè¿˜æ²¡æœ‰ä»»ä½•å†…å®¹'
    }
  }

  private getDefaultActionText(): string {
    switch (this.currentConfig.type) {
      case 'error': return 'é‡è¯•'
      case 'network': return 'åˆ·æ–°'
      case 'permission': return 'å»è®¾ç½®'
      default: return 'å¼€å§‹ä½¿ç”¨'
    }
  }

  @Builder
  private DefaultIcon() {
    Text(this.currentConfig.icon || this.getDefaultIcon())
      .fontSize(64)
      .fontColor('#C0C0C0')
      .textAlign(TextAlign.Center)
      .margin({ bottom: 16 })
  }

  @Builder
  private SearchEmptyState() {
    Column({ space: 16 }) {
      Text('ğŸ”')
        .fontSize(64)
        .fontColor('#E0E0E0')
        .textAlign(TextAlign.Center)

      Text('æœªæ‰¾åˆ°åŒ¹é…ç»“æœ')
        .fontSize(18)
        .fontWeight(FontWeight.Medium)
        .fontColor('#666666')
        .textAlign(TextAlign.Center)

      Text('å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ä½¿ç”¨å…¶ä»–å…³é”®è¯')
        .fontSize(14)
        .fontColor('#999999')
        .textAlign(TextAlign.Center)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
        .margin({ top: 4 })
    }
  }

  @Builder
  private ErrorEmptyState() {
    Column({ space: 16 }) {
      Text('âš ï¸')
        .fontSize(64)
        .fontColor('#FFB800')
        .textAlign(TextAlign.Center)

      Text('å‡ºç°äº†ä¸€äº›é—®é¢˜')
        .fontSize(18)
        .fontWeight(FontWeight.Medium)
        .fontColor('#666666')
        .textAlign(TextAlign.Center)

      Text('è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•')
        .fontSize(14)
        .fontColor('#999999')
        .textAlign(TextAlign.Center)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
        .margin({ top: 4 })

      if (this.currentConfig.onAction) {
        Button() {
          Text('é‡è¯•')
            .fontSize(14)
            .fontColor('#FFFFFF')
            .fontWeight(FontWeight.Medium)
        }
        .height(40)
        .padding({ left: 24, right: 24 })
        .backgroundColor(ThemeManager.getCurrentPrimaryColor())
        .borderRadius(20)
        .margin({ top: 16 })
        .onClick(this.currentConfig.onAction)
      }
    }
  }

  @Builder
  private NetworkEmptyState() {
    Column({ space: 16 }) {
      Text('ğŸŒ')
        .fontSize(64)
        .fontColor('#1890FF')
        .textAlign(TextAlign.Center)

      Text('ç½‘ç»œè¿æ¥å¼‚å¸¸')
        .fontSize(18)
        .fontWeight(FontWeight.Medium)
        .fontColor('#666666')
        .textAlign(TextAlign.Center)

      Text('è¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®åé‡è¯•')
        .fontSize(14)
        .fontColor('#999999')
        .textAlign(TextAlign.Center)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
        .margin({ top: 4 })

      if (this.currentConfig.onAction) {
        Button() {
          Text('åˆ·æ–°')
            .fontSize(14)
            .fontColor('#FFFFFF')
            .fontWeight(FontWeight.Medium)
        }
        .height(40)
        .padding({ left: 24, right: 24 })
        .backgroundColor(ThemeManager.getCurrentPrimaryColor())
        .borderRadius(20)
        .margin({ top: 16 })
        .onClick(this.currentConfig.onAction)
      }
    }
  }

  @Builder
  private PermissionEmptyState() {
    Column({ space: 16 }) {
      Text('ğŸ”’')
        .fontSize(64)
        .fontColor('#FAAD14')
        .textAlign(TextAlign.Center)

      Text('éœ€è¦ç›¸å…³æƒé™')
        .fontSize(18)
        .fontWeight(FontWeight.Medium)
        .fontColor('#666666')
        .textAlign(TextAlign.Center)

      Text('è¯·åœ¨è®¾ç½®ä¸­å¼€å¯æ‰€éœ€æƒé™ä»¥ç»§ç»­ä½¿ç”¨')
        .fontSize(14)
        .fontColor('#999999')
        .textAlign(TextAlign.Center)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
        .margin({ top: 4 })

      if (this.currentConfig.onAction) {
        Button() {
          Text('å»è®¾ç½®')
            .fontSize(14)
            .fontColor('#FFFFFF')
            .fontWeight(FontWeight.Medium)
        }
        .height(40)
        .padding({ left: 24, right: 24 })
        .backgroundColor(ThemeManager.getCurrentPrimaryColor())
        .borderRadius(20)
        .margin({ top: 16 })
        .onClick(this.currentConfig.onAction)
      }
    }
  }

  @Builder
  private DefaultEmptyState() {
    Column({ space: 16 }) {
      // å›¾æ ‡
      this.DefaultIcon()

      // æ ‡é¢˜
      Text(this.currentConfig.title || this.getDefaultTitle())
        .fontSize(18)
        .fontWeight(FontWeight.Medium)
        .fontColor('#666666')
        .textAlign(TextAlign.Center)

      // æè¿°
      Text(this.currentConfig.description || this.getDefaultDescription())
        .fontSize(14)
        .fontColor('#999999')
        .textAlign(TextAlign.Center)
        .maxLines(3)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
        .margin({ top: 4 })

      // æ“ä½œæŒ‰é’®
      if (this.currentConfig.actionText && this.currentConfig.onAction) {
        Button() {
          Text(this.currentConfig.actionText)
            .fontSize(14)
            .fontColor('#FFFFFF')
            .fontWeight(FontWeight.Medium)
        }
        .height(40)
        .padding({ left: 24, right: 24 })
        .backgroundColor(ThemeManager.getCurrentPrimaryColor())
        .borderRadius(20)
        .margin({ top: 16 })
        .onClick(this.currentConfig.onAction)
      }
    }
  }

  build() {
    Column() {
      // æ ¹æ®ç±»å‹é€‰æ‹©ä¸åŒçš„ç©ºçŠ¶æ€
      if (this.currentConfig.type === 'search') {
        this.SearchEmptyState()
      } else if (this.currentConfig.type === 'error') {
        this.ErrorEmptyState()
      } else if (this.currentConfig.type === 'network') {
        this.NetworkEmptyState()
      } else if (this.currentConfig.type === 'permission') {
        this.PermissionEmptyState()
      } else {
        this.DefaultEmptyState()
      }
    }
    .width('100%')
    .height(this.height || 300)
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .padding(32)
    .backgroundColor(this.showBackground ? '#FAFAFA' : Color.Transparent)
    .borderRadius(this.showBackground ? 12 : 0)
  }
}