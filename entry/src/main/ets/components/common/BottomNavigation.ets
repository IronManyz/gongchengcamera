/**
 * åº•éƒ¨å¯¼èˆªæ ç»„ä»¶
 * æä¾›ç»Ÿä¸€çš„åº•éƒ¨å¯¼èˆªåŠŸèƒ½
 */

import router from '@ohos.router'

export interface NavigationItem {
  icon: string
  label: string
  route: string
  params?: ESObject
}

@ComponentV2
export struct BottomNavigation {
  @Param currentPage: string = ''
  @Param onNavigationChange?: (page: string) => void = () => {}

  private navigationItems: NavigationItem[] = [
    {
      icon: 'ðŸ—ï¸',
      label: 'å·¥ç¨‹',
      route: 'pages/MainPage'
    },
    {
      icon: 'ðŸ“±',
      label: 'ç›¸å†Œ',
      route: 'pages/gallery/GalleryPlaceholderPage'
    },
    {
      icon: 'âš™ï¸',
      label: 'è®¾ç½®',
      route: 'pages/settings/SettingsPlaceholderPage'
    }
  ]

  private handleNavigation(item: NavigationItem): void {
    console.log('Navigate to:', item.route)

    // ï¿½ï¿½ï¿½æžœç‚¹å‡»çš„æ˜¯å½“å‰é¡µé¢ï¼Œä¸åšä»»ä½•æ“ä½œ
    if (item.route === this.currentPage) {
      return
    }

    // é€šçŸ¥çˆ¶ç»„ä»¶å¯¼èˆªå˜åŒ–
    this.onNavigationChange?.(item.route)

    // æ‰§è¡Œé¡µé¢è·³è½¬
    try {
      router.replaceUrl({
        url: item.route,
        params: item.params || {} as ESObject
      }).catch((error: Error) => {
        console.error('Navigation failed:', error)
      })
    } catch (error) {
      console.error('Navigation exception:', error)
    }
  }

  build() {
    Row() {
      ForEach(this.navigationItems, (item: NavigationItem) => {
        Column() {
          Text(item.icon)
            .fontSize(24)
            .fontColor(this.getPageIconColor(item.route))
          Text(item.label)
            .fontSize(12)
            .fontColor(this.getPageIconColor(item.route))
            .margin({ top: 4 })
        }
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)
        .alignItems(HorizontalAlign.Center)
        .backgroundColor(this.getPageBackgroundColor(item.route))
        .borderRadius(8)
        .padding({ top: 4, bottom: 4 })
        .animation({ duration: 200, curve: Curve.EaseInOut })
        .onClick(() => {
          this.handleNavigation(item)
        })
      })
    }
    .width('100%')
    .height(60)
    .backgroundColor('#FFFFFF')
    .border({ width: { top: 1 }, color: '#E8E8E8' })
    .justifyContent(FlexAlign.SpaceAround)
    .padding({ bottom: 8 }) // ä¸ºå®‰å…¨åŒºåŸŸç•™å‡ºç©ºé—´
  }

  private getPageIconColor(route: string): string {
    return this.currentPage === route ? '#1890FF' : '#8C8C8C'
  }

  private getPageBackgroundColor(route: string): string {
    return this.currentPage === route ? '#E6F7FF' : ''
  }
}