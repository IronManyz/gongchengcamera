/**
 * æµ‹è¯•é¡µé¢
 * æµ‹è¯•æ–°ç»„ä»¶åŠŸèƒ½
 */

import router from '@ohos.router'
import { StatCard } from '../components/common/StatCard'
import { SimpleProjectCard } from '../components/project/SimpleProjectCard'
import { SimpleProject } from '../models/SimpleProject'
import { ProjectStatus } from '../types/SimpleTypes'

@Entry
@ComponentV2
struct TestPage {
  @Local message: string = 'Hello World'
  @Local counter: number = 0
  @Local showCards: boolean = false
  @Local testProject: SimpleProject = new SimpleProject('æµ‹è¯•é¡¹ç›®', 'TEST001')

  aboutToAppear() {
    console.log('TestPage aboutToAppear')
    // Initialize the SimpleProject
    this.testProject = new SimpleProject('æµ‹è¯•é¡¹ç›®', 'TEST001')
  }

  build() {
    Column() {
      Text(this.message)
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 20, bottom: 20 })

      Text(`è®¡æ•°å™¨: ${this.counter}`)
        .fontSize(20)
        .margin({ bottom: 20 })

      // æµ‹è¯•æŒ‰é’®åŒºåŸŸ
      Column() {
        Button('ç‚¹å‡»æˆ‘ +1')
          .fontSize(16)
          .width(180)
          .height(45)
          .backgroundColor('#007DFF')
          .margin({ bottom: 10 })
          .onClick(() => {
            this.counter++
            console.log(`Button clicked! Counter: ${this.counter}`)
          })

        Button('é‡ç½®è®¡æ•°å™¨')
          .fontSize(16)
          .width(180)
          .height(45)
          .backgroundColor('#FF6B6B')
          .margin({ bottom: 10 })
          .onClick(() => {
            this.counter = 0
            console.log('Counter reset!')
          })

        Button('æ”¹å˜æ–‡å­—')
          .fontSize(16)
          .width(180)
          .height(45)
          .backgroundColor('#52C41A')
          .margin({ bottom: 10 })
          .onClick(() => {
            this.message = this.message === 'Hello World' ? 'ä½ å¥½ï¼Œä¸–ç•Œï¼' : 'Hello World'
            console.log('Message changed!')
          })

        Button(this.showCards ? 'éšè—ç»„ä»¶' : 'æ˜¾ç¤ºç»„ä»¶')
          .fontSize(16)
          .width(180)
          .height(45)
          .backgroundColor('#9B59B6')
          .margin({ bottom: 10 })
          .onClick(() => {
            this.showCards = !this.showCards
            console.log(`Cards visibility: ${this.showCards}`)
          })

        Button('è¿”å›žä¸»é¡µ')
          .fontSize(16)
          .width(180)
          .height(45)
          .backgroundColor('#34495E')
          .onClick(() => {
            router.back()
          })
      }
      .margin({ bottom: 20 })

      // ç»„ä»¶æµ‹è¯•åŒºåŸŸ
      if (this.showCards) {
        Column() {
          Text('ðŸŽ¯ ç»„ä»¶æµ‹è¯•åŒºåŸŸ')
            .fontSize(18)
            .fontWeight(FontWeight.Medium)
            .margin({ bottom: 16 })

          // ç»Ÿè®¡å¡ç‰‡æµ‹è¯•
          Row() {
            StatCard({
              title: 'æµ‹è¯•æ•°å€¼1',
              value: this.counter,
              icon: 'ðŸ“',
              color: '#1890FF',
              trend: 'up'
            })
            .layoutWeight(1)

            StatCard({
              title: 'æµ‹è¯•æ•°å€¼2',
              value: this.counter * 2,
              icon: 'ðŸ“Š',
              color: '#52C41A',
              trend: 'stable'
            })
            .layoutWeight(1)
          }
          .width('100%')
          .margin({ bottom: 16 })

          Text('âœ… StatCard ç»„ä»¶å·¥ä½œæ­£å¸¸!')
            .fontSize(14)
            .fontColor('#52C41A')
            .margin({ bottom: 20 })

          // é¡¹ç›®å¡ç‰‡æµ‹è¯•
          SimpleProjectCard({
            project: this.testProject,
            showStats: true,
            onTap: (project) => {
              console.log(`ç‚¹å‡»äº†é¡¹ç›®: ${project.getDisplayName()}`)
            },
            onLongPress: (project) => {
              console.log(`é•¿æŒ‰äº†é¡¹ç›®: ${project.getDisplayName()}`)
            }
          })
          .width('100%')
          .margin({ bottom: 16 })

          Text('âœ… SimpleProjectCard ç»„ä»¶å·¥ä½œæ­£å¸¸!')
            .fontSize(14)
            .fontColor('#52C41A')
            .margin({ bottom: 16 })

          Button('æ›´æ–°é¡¹ç›®æ•°æ®')
            .fontSize(14)
            .width(150)
            .height(40)
            .backgroundColor('#3498DB')
            .margin({ bottom: 16 })
            .onClick(() => {
              this.testProject.siteCount = this.counter
              this.testProject.photoCount = this.counter * 3
              this.testProject.client = 'æµ‹è¯•å®¢æˆ·å…¬å¸'
              this.testProject.manager = 'å¼ ç»ç†'
              console.log('é¡¹ç›®æ•°æ®å·²æ›´æ–°')
            })

          Button('è·³è½¬åˆ°é¡¹ç›®åˆ—è¡¨æµ‹è¯•')
            .fontSize(16)
            .width(200)
            .height(45)
            .backgroundColor('#E67E22')
            .onClick(() => {
              router.pushUrl({
                url: 'pages/project/ProjectListPage',
                params: {}
              }).catch((error: Error) => {
                console.error('è·³è½¬åˆ°é¡¹ç›®åˆ—è¡¨å¤±è´¥:', error)
              })
            })
        }
        .width('100%')
        .padding(16)
        .backgroundColor('#FFFFFF')
        .borderRadius(8)
        .margin({ left: 16, right: 16 })
      }

      Blank()
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Start)
    .alignItems(HorizontalAlign.Center)
    .backgroundColor('#F5F5F5')
    .padding({ top: 20, bottom: 20 })
  }
}